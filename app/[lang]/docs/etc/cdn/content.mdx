# 개요
구인 글들을 훑던도중 미디어 인프라 관리라는 부분에 꽃혔다.  
AWS, CDN, OVP(Online Video Platform), OTT(Over-the-top media service) 등등...  
이런것들을 다루는 일이 꽤나 재밌을 것 같다. 사실 서류에 통과해버려 벼락치기인건 비밀이다.  

생소한 용어들에 대해 알아보고 구현한 기술들을 정리해보자.  

## Terminology. 
### Real-time Messaging Protocol (RTMP)
RTMP는 Adobe Systems에서 개발한 통신 프로토콜으로 웹에서 오디오, 비디오 및 데이터를 스트리밍하는 데 사용된다.  
[Nginx-RTMP](https://docs.nginx.com/nginx/admin-guide/dynamic-modules/rtmp/)로 쉽게 구현할 수 있다.  
- https://www.hostwinds.kr/tutorials/live-streaming-from-a-vps-with-nginx-rtmp
- https://blog.ifixcomputer.org/2021/04/nginx-%EC%97%94%EC%A7%84%EC%97%91%EC%8A%A4%EB%A1%9C-cdncontent-delivery-network%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95-%ED%95%98%EA%B8%B0/#google_vignette

### HLS (HTTP Live Streaming)
HLS는 HTTP 기반의 스트리밍 프로토콜로, Apple에서 개발했다.  
HLS는 비디오 및 오디오를 여러 비트 전송률로 인코딩하고, 클라이언트에게 네트워크 대역폭에 따라 가장 적합한 비트 전송률을 선택하도록 한다.  

### CDN (Content Delivery Network). 
CDN은 콘텐츠 전송 네트워크로, 특정 앱(Origin)을 전 세계에 분산된 서버(Edge)를 사용하여 콘텐츠를 빠르게 전송한다.    
주로 AWS CloudFront, Google Cloud CDN, Azure CDN 등을 사용하지만, 특정 콘텐츠에 대한 CDN을 직접 구축할 수도 있다.  
- [CDN 구축](https://dev.to/janreges/how-to-build-a-cdn-1-3-introduction-and-basic-components-345o)
- [nginx-엔진엑스로-cdncontent-delivery-network서버-구축-하기](https://blog.ifixcomputer.org/2021/04/nginx-%EC%97%94%EC%A7%84%EC%97%91%EC%8A%A4%EB%A1%9C-cdncontent-delivery-network%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95-%ED%95%98%EA%B8%B0/#google_vignette)

### SRT (Secure Reliable Transport)
SRT는 Haivision에서 개발한 오픈 소스 비디오 스트리밍 프로토콜로 불안정한 네트워크 환경에서 안정적인 비디오 스트리밍을 제공한다.    
오픈 소스 `FFmpeg`는 대부분의 비디오 스트리밍 프로토콜을 지원하며, SRT도 그 중 하나이다.
- [FFmpeg](https://www.ffmpeg.org/)


### Anti-piracy - mDRM
mDRM은 여러 DRM 시스템을 결합하여 콘텐츠 보호 계층을 강화하는 기술입니다. 각 DRM 시스템은 고유한 암호화 및 워터마킹 방식을 사용하여 콘텐츠를 보호합니다.   
이를 통해 해커가 한 DRM 시스템을 우회하더라도 다른 시스템에 의해 콘텐츠가 여전히 보호됩니다.  

mDRM의 주요 장점은 다음과 같습니다.  
- 향상된 보안: 여러 DRM 시스템을 사용하여 콘텐츠를 보호하면 해커가 콘텐츠에 액세스하기 어려워집니다.
- 유연성: 다양한 콘텐츠 유형과 플랫폼을 지원하는 다양한 DRM 시스템을 사용할 수 있습니다.
- 미래 지향성: 새로운 DRM 기술이 개발될 때 쉽게 통합할 수 있습니다.
대표적인 DRM으로는 Widevine, PlayReady, FairPlay 등이 있다.

### 구현 요소
- **AES 암호화**: 콘텐츠를 암호화하여 승인된 사용자만 액세스할 수 있도록 합니다.
- **디지털 서명**: 콘텐츠의 무결성을 확인하고 변조를 방지합니다.
- **사용 권한 관리**: 사용자가 콘텐츠를 얼마나 많은 장치에 다운로드하고 얼마 동안 스트리밍할 수 있는지 제어합니다.


### forensic watermark
포렌식 워터마킹은 디지털 콘텐츠에 숨겨진 고유 식별자를 포함하는 기술입니다.   
이러한 식별자는 무단 복제된 콘텐츠를 추적하고 출처를 식별하는 데 사용할 수 있습니다.   
포렌식 워터마킹은 다음과 같은 여러 가지 방법으로 구현될 수 있습니다.

- **영상**: 비디오 프레임에 미세한 변경 사항을 포함하여 숨겨진 워터마크를 만듭니다.
- **오디오**: 오디오 신호에 미세한 변경 사항을 포함하여 숨겨진 워터마크를 만듭니다.
- **문서**: 문서 텍스트에 숨겨진 메타데이터를 포함하여 워터마크를 만듭니다.
- **포렌식**: 주요 장점은 다음과 같습니다.

#### Earning
- 추적 가능성: 무단 복제된 콘텐츠를 추적하고 출처를 식별하는 데 사용할 수 있습니다.
- 증거 제시: 저작권 침해 소송에서 증거로 사용할 수 있습니다.
- 억제 효과: 잠재적인 해커 억제 효과를 줄 수 있습니다.







## Prerequisites.
nginx를 proxy server로 사용할 것으로 아래문서를 참고하여 설치하자.
- [Nginx Setup](https://www.peachhub.love/ko/docs/etc/nginx-binary)



## Traffic 차단
Nginx를 사용하여 특정 IP를 24시간 차단하는 방법
Nginx를 사용하여 Ubuntu 또는 Nginx 서버에서 너무 많은 트래픽을 유발하는 특정 IP를 24시간 차단하는 방법은 다음과 같습니다.

단계:

Nginx 설정 파일 편집:
`/etc/nginx/nginx.conf` 또는 사용자 지정 Nginx 설정 파일을 편집합니다.
### 블록 섹션 추가
다음과 같은 형식의 block 섹션을 추가합니다.
```
block {
    limit_req zone=block_ip;

    server_name example.com;

    deny 192.0.2.123; # 차단하려는 IP 주소를 192.0.2.123으로 변경합니다.
}
```

- `zone=block_ip`은 `limit_req` 지침에 사용될 named zone을 정의합니다.
- `server_name` 은 차단할 호스트 이름 또는 도메인 이름입니다.
- `deny IP address;` 는 차단할 IP 주소를 지정합니다.

`/etc/nginx/named.conf` 또는 사용자 지정 named 설정 파일을 편집합니다.
### zone 섹션 추가:  
DNS Zone file
```
zone block_ip {
    type master;
    files {
        /var/lib/nginx/block_ip.hosts;
    };
};
```
- `type master;`: `block_ip` zone이 마스터 zone임을 나타냅니다.
- `files { /var/lib/nginx/block_ip.hosts; }`: `block_ip.hosts` 파일에서 IP 주소 목록을 로드하도록 합니다.  
- 
`/var/lib/nginx/block_ip.hosts` 파일을 생성합니다.

### 차단된 IP 목록 추가:
다음 형식으로 차단하려는 IP 주소 목록을 추가합니다.
```
127.0.0.1 example.com; 
```
도메인의 모든 요청을 차단합니다.
### Nginx를 다시 시작
`sudo nginx -t` 명령을 사용하여 설정 파일을 검증합니다.   
오류가 없으면 `sudo systemctl restart nginx` 명령을 사용하여 Nginx를 다시 시작합니다.

#### 주의:
이 설정은 특정 IP 주소에 대한 모든 트래픽을 차단합니다.   
차단하기 전에 IP 주소가 유효한지 확인하십시오.
limit_req 지침은 Nginx 버전에 따라 다를 수 있습니다. 사용 중인 Nginx 버전의 문서를 참조하십시오.
